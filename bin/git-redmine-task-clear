#!/bin/bash

source /usr/local/share/Git-Redmine-Suite/helpers/current_git_command
function help {
    echo "$CURRENT_GIT_COMMAND TASK_NUMBER"
    exit 1
}

if [ -n "$HELP" ]
then
    help
fi

set -e

source /usr/local/share/Git-Redmine-Suite/helpers/redmine-checkconf
source /usr/local/share/Git-Redmine-Suite/helpers/redmine-statuses
source /usr/local/share/Git-Redmine-Suite/helpers/redmine-title
source /usr/local/share/Git-Redmine-Suite/helpers/redmine-project

TASK="$1"

if [ -z "$TASK" ]
then
    help
fi

BRNAME=$(git config "redmine.task.${TASK}.branch")

echo "Cleaning local and remote dev for task $TASK..."

git fetch -ap
git fetch --tags -p
git checkout devel
git merge origin/devel
git branch -D "$BRNAME"
git push origin :"$BRNAME"
git config --remove-section "redmine.task.$TASK"

