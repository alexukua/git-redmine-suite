#!/bin/bash

if [ "x$HELP" != "x" ]
then
    echo "git redmine setup PROFILE AUTH_KEY"
    exit 1
fi

set -e
case $1 in
    weborama)
        REDMINE_URL="http://redmine.intranet.weborama.com"
        REDMINE_AUTHKEY="$2"
        if [ "x$REDMINE_AUTHKEY" == "x" ]
        then
            echo "You need to pass your auth key from redmine to run the setup !"
            echo ""
            exit 1
        fi
        set -x
        set +e
        git config --global --remove-section "redmine"
        git config --global --remove-section "redmine.user"
        git config --global --remove-section "redmine.statuses.task"
        git config --global --remove-section "redmine.statuses.review"
        set -e
        git config --global --add redmine.url "$REDMINE_URL"
        git config --global --add redmine.authkey "$REDMINE_AUTHKEY"
        git config --global --add redmine.user.id $(/usr/local/share/Git-Redmine-Suite/helpers/redmine-get-current-user-id --auth_key="$REDMINE_AUTHKEY" --server_url="$REDMINE_URL" --id_only)
        git config --global --add redmine.statuses.task.assigned 2
        git config --global --add redmine.statuses.task.inprogress 7
        git config --global --add redmine.statuses.review.assigned 14
        git config --global --add redmine.statuses.review.inprogress 27
        git config --global --add redmine.statuses.review.finish 10
    ;;
    *)
        echo "git redmine setup PROFILE AUTH_KEY"
        echo ""
        echo "Profiles :"
        echo ""
        echo "    * weborama"
        echo ""
    ;;
esac
