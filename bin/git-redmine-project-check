#!/bin/bash

source /usr/local/share/Git-Redmine-Suite/helpers/current_git_command
if [ "x$HELP" != "x" ]
then
    echo $CURRENT_GIT_COMMAND
    exit 1
fi

set -e

source /usr/local/share/Git-Redmine-Suite/helpers/redmine-checkconf

set +e

echo "Checking your projects :"
for P in $(git config --get-regex ^redmine.project | cut -d '.' -f 3 | sort -u)
do
	REVIEWER=$(git config redmine.project.$P.finish.user.id.task)
	RELEASER=$(git config redmine.project.$P.finish.user.id.review)
	INTEGRATOR=$(git config redmine.project.$P.finish.user.id.release)
	GIT_REPOS=$(git config redmine.project.$P.cf.git.repos)
	GIT_PR=$(git config redmine.project.$P.cf.git.pr)
	GIT_RELEASE=$(git config redmine.project.$P.cf.git.release)
    echo "    * $P (Reviewer: $REVIEWER, Releaser: $RELEASER , Integrator: $INTEGRATOR)"
    if [ -z $GIT_REPOS ] || [ -z $GIT_PR ] || [ -z $GIT_RELEASE ]
   	then
   		echo ""
   		echo "Missing conf, run setup again ..."
   		git redmine project setup "$P" "$REVIEWER" "$RELEASER" "$INTEGRATOR" || git redmine project remove "$P" || true
    fi
    echo ""
done
echo ""
