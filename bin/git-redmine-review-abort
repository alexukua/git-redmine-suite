#!/bin/bash

function help {
    echo "git redmine review abort TASK_NUMBER"
    exit 1
}

TASK="$1"

if [ "x$TASK" == "x" ]
then
    help
fi

source /usr/local/share/Git-Redmine-Suite/helpers/redmine-checkconf
source /usr/local/share/Git-Redmine-Suite/helpers/redmine-statuses

set -e

TASK_TITLE=$(git config "redmine.review.$TASK.title")
BRNAME=$(git config "redmine.review.$TASK.branch")

echo "Aborting the review of task #$TASK - PR:$PR ..."
echo "    * $TASK_TITLE"
echo ""

set -x
git checkout devel
git branch -D "$BRNAME"
git config --remove-section "redmine.review.$TASK"
set +x

echo ""
echo "Updating redmine status ..."
redmine_set_status $TASK $REDMINE_REVIEW_TODO $REDMINE_USER_ID
echo ""
