#!/bin/bash

source /usr/local/share/Git-Redmine-Suite/helpers/current_git_command
if [ -n "$HELP" ]
then
    echo "$CURRENT_GIT_COMMAND"
    exit 1
fi

set -e

source /usr/local/share/Git-Redmine-Suite/helpers/redmine-checkconf
source /usr/local/share/Git-Redmine-Suite/helpers/redmine-project

set +e
redmine_get_cf_conf
set -e

GIT_REPOS_URL=$(git config remote.origin.url)

declare -a PARAMS=(--auth_key "$REDMINE_AUTHKEY" --server_url "$REDMINE_URL" --assigned_to_id "$REDMINE_USER_ID" --status_id "$REDMINE_RELEASE_TODO" --cf_id "$GIT_REPOS_ID" --cf_val "$GIT_REPOS_URL")

/usr/local/share/Git-Redmine-Suite/helpers/redmine-get-tasks ${PARAMS[@]}
